zjleblanc.reporting.table_per_host
=========

Generate a tabular HTML report
[View Example ðŸ“ˆ](https://reports.autodotes.com/roles/table_per_host.last_login.html)

Galaxy Tags: \[ report table per_host html \]

Required Variables
------------------

| Name | Example | Description |
| -------- | ------- | ------------------- |
| table_data_fact | fact which contains list[list] OR list[dict] | tabular data fact set for each host in `{{ table_hosts }}` |
| table_output_remote_host | report_server | inventory host to copy report to |


Role Variables
--------------

| Variable | Type | Value or Expression | Description |
| -------- | ------- | ------------------- | --------- |
| table_title | default | Auto-generated Report |  |
| table_desc | default | Report generated by zjleblanc.reporting.table_per_host Ansible role | |
| table_hosts | default | {{ ansible_play_hosts }} | A set of hosts in the inventory to report on |
| table_timestamp | default | {{ lookup('pipe', 'date +"%Y-%m-%d @ %H:%M:%S"') }} |  |
| table_data_type | default | dict | type of input data ([see examples](#choosing-data-type)) |
| table_headers_fact | default | table_data_headers | tabular data headers fact set for each host in `{{ table_hosts }}` |
| table_headers | default | ["First Name", "Last Name", "Birthday"] | optionally provide column headers |
| table_first_row_headers | default | False | flag for headers in the first row |
| table_output_dest | default | {{ playbook_dir }}/zjleblanc.table_per_host.html |  |
| table_accent_color | default | #37a3a3 | Styles the select box for choosing a host report to view |

Choosing Data Type
------------------

When the input data is a list of objects, use **table_data_type: dict**. Example data below:
```json
[
  {
    "Username": "zleblanc",
    "Last Logon": "09/05/2024"
  },
  {
    "Username": "ansible",
    "Last Logon": "09/07/2024"
  },
  ...
]
```

When the input data is a list of lists, use **table_data_type: list**. Example data below:
```json
[
  ["zleblanc", "09/05/2024"],
  ["ansible", "09/06/2024"],
  ...
]
```

Setting the Data
------------------

Each host in `table_hosts` which defaults to `ansible_play_hosts` needs a fact set which contains data for the report. The fact name is determined by `table_data_fact`.

For example, if `table_data_fact: last_logon_report_data` is used, then a corresponding task like this should precede calling the role:

```yaml
    - name: Set report data fact
      ansible.builtin.set_fact:
        last_logon_report_data:
          - "Username": zleblanc
            "Last Logon": 09/05/2024
          - "Username": ansible
            "Last Logon": 09/07/2024
        last_logon_report_data_headers:
          - "Username"
          - "Last Logon"
```

Of course, you will want to have the data generated dynamically. In my blog post, I will provide an example using the results of a call to `last` combined with an inspection of each user's home directory.

Examples
--------

```yaml
  - name: Inferring headers from dictionary data
    hosts: servers
    tasks:
      - name: Infer headers from dictionary data
        run_once: true
        ansible.builtin.include_role:
          name: zjleblanc.reporting.table
        vars:
          table_title: Last Login Report
          table_data_fact: last_login_report_data
          table_headers_fact: last_login_report_data_headers # host specific headers
          table_data_type: dict
          table_output_remote_host: report_server
          table_output_dest: "{{ reports_dir }}/table.html"

      - name: Provide separate headers for list data
        run_once: true
        ansible.builtin.include_role:
          name: zjleblanc.reporting.table
        vars:
          table_title: Last Login Report
          table_data_fact: last_login_report_data
          table_data_type: list
          table_headers: ["Last Logon", "Username"] # Generic headers for all hosts
          table_output_remote_host: report_server
          table_output_dest: "{{ reports_dir }}/table.html"

      - name: Provide list data with headers in the first row
        run_once: true
        ansible.builtin.include_role:
          name: zjleblanc.reporting.table
        vars:
          table_data_fact: last_login_report_data
          table_data_type: list
          table_first_row_headers: true
          table_output_remote_host: report_server
          table_output_dest: "{{ reports_dir }}/table.html"
```

License
-------

license (GPL-2.0-or-later, MIT, etc)

Author Information
-------
**Zachary LeBlanc**

Red Hat
